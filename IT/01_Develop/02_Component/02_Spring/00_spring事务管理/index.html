
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../../../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.3.0, mkdocs-material-8.3.9" name="generator"/>
<title>Spring事务管理 - obsidian-mkdocs template</title>
<link href="../../../../../assets/stylesheets/main.1d29e8d0.min.css" rel="stylesheet"/>
<link href="../../../../../assets/stylesheets/palette.cbb835fc.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="pink" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#spring">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="obsidian-mkdocs template" class="md-header__button md-logo" data-md-component="logo" href="../../../../.." title="obsidian-mkdocs template">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            obsidian-mkdocs template
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Spring事务管理
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="pink" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="pink" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="obsidian-mkdocs template" class="md-nav__button md-logo" data-md-component="logo" href="../../../../.." title="obsidian-mkdocs template">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    obsidian-mkdocs template
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../..">
        Obsidian Notes
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
          Features
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Features" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Features
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Features/LaTeX%20Math%20Support/">
        LaTeX Math Support
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Features/Mermaid%20Diagrams/">
        Mermaid diagrams
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Features/Text%20Formatting/">
        Text Formatting
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3">
          IT
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="IT" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          IT
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" id="__nav_3_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_1">
          00 Algorithm
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="00 Algorithm" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_1">
<span class="md-nav__icon md-icon"></span>
          00 Algorithm
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_1" id="__nav_3_1_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_1_1">
          00 Algo
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="00 Algo" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_3_1_1">
<span class="md-nav__icon md-icon"></span>
          00 Algo
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../00_Algorithm/00_Algo/00_%E6%A8%A1%E6%8B%9F/">
        模拟
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../00_Algorithm/00_Algo/01_%E6%A0%91/">
        二叉树
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../00_Algorithm/00_Algo/02_%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/">
        区间DP
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../00_Algorithm/00_Algo/03_%E6%8E%92%E5%BA%8F/">
        TimSort
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_2" id="__nav_3_1_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_1_2">
          01 OI
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="01 OI" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_3_1_2">
<span class="md-nav__icon md-icon"></span>
          01 OI
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../00_Algorithm/01_OI/00_%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/">
        刷题汇总
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../00_Algorithm/01_OI/2022-04-05/">
        [NOIP2006 普及组] 数列
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../00_Algorithm/01_OI/2022-04-08/">
        Hz吐泡泡
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../00_Algorithm/01_OI/2022-04-10/">
        算式
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" id="__nav_3_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_2">
          01 Develop
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="01 Develop" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_2">
<span class="md-nav__icon md-icon"></span>
          01 Develop
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_1" id="__nav_3_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_2_1">
          01 Language
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="01 Language" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_3_2_1">
<span class="md-nav__icon md-icon"></span>
          01 Language
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../01_Language/03_Scala/">
        Scala
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_1_2" id="__nav_3_2_1_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_2_1_2">
          01 Java
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="01 Java" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_3_2_1_2">
<span class="md-nav__icon md-icon"></span>
          01 Java
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../01_Language/01_Java/01_Java%E5%B7%A5%E5%85%B7%E7%B1%BB/">
        Java集合类
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_2" id="__nav_3_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_2_2">
          02 Component
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="02 Component" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_3_2_2">
<span class="md-nav__icon md-icon"></span>
          02 Component
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../01_Flink/">
        Flink
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_2_2" id="__nav_3_2_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_2_2_2">
          00 Kafka
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="00 Kafka" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_3_2_2_2">
<span class="md-nav__icon md-icon"></span>
          00 Kafka
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../00_Kafka/00_kafka%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/">
        Kafka基本概念
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_2_2_2" id="__nav_3_2_2_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_2_2_2_2">
          01 broker
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="01 broker" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_3_2_2_2_2">
<span class="md-nav__icon md-icon"></span>
          01 broker
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../00_Kafka/01_broker/00_%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97/">
        1 日志段
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../00_Kafka/01_broker/01_%E7%B4%A2%E5%BC%95%E6%A8%A1%E5%9D%97/">
        01 索引模块
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_2_3" id="__nav_3_2_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_2_2_3">
          02 Spring
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="02 Spring" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_3_2_2_3">
<span class="md-nav__icon md-icon"></span>
          02 Spring
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Spring事务管理
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Spring事务管理
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-jdbc">
    1. JDBC事务管理
  </a>
<nav aria-label="1. JDBC事务管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11">
    1.1. 基本创建、提交、回滚事务
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#12">
    1.2. 隔离级别和保存点
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-spring">
    2. Spring事务管理
  </a>
<nav aria-label="2. Spring事务管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#21-programmatically">
    2.1. 编程式事务管理（Programmatically）
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#22-declarative">
    2.2 声明式事务管理（Declarative）
  </a>
<nav aria-label="2.2 声明式事务管理（Declarative）" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#221-xml">
    2.2.1. 在 XML 中声明
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#222-transactional">
    2.2.2. 使用 @Transactional 注解声明
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#223">
    2.2.3. 声明式事务实现
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#23-transactionmanager">
    2.3. TransactionManager接口
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#24">
    2.4. 物理事务与逻辑事务（事务的传播）
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#25-transactionsynchronizationmanager">
    2.5. TransactionSynchronizationManager 类
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#26">
    2.6. 事务回滚
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#27">
    2.7. 事务隔离级别
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#28">
    2.8. 事务易错点
  </a>
<nav aria-label="2.8. 事务易错点" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
    调用同一个类中的方法
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3">
    3. 总结
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4">
    4. 思考题
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" id="__nav_3_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3">
          99 Attachment
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="99 Attachment" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_3">
<span class="md-nav__icon md-icon"></span>
          99 Attachment
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../99_Attachment/00_%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95%E6%A8%A1%E6%9D%BF/">
        题目名称
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" id="__nav_3_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_4">
          Excalidraw
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Excalidraw" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_4">
<span class="md-nav__icon md-icon"></span>
          Excalidraw
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../Excalidraw/2022-04-10/">
        2022 04 10
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../Excalidraw/2022-04-12-jobgraph/">
        2022 04 12 jobgraph
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../Excalidraw/2022-05-08-spring_transactional_overview/">
        2022 05 08 spring transactional overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../Excalidraw/tim-sort-merge-space-overhead/">
        Tim sort merge space overhead
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4">
          Topic 1
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Topic 1" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Topic 1
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Topic%201/Note%201/">
        Note 1
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../Topic%201/Note%202/">
        Note 2
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-jdbc">
    1. JDBC事务管理
  </a>
<nav aria-label="1. JDBC事务管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11">
    1.1. 基本创建、提交、回滚事务
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#12">
    1.2. 隔离级别和保存点
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-spring">
    2. Spring事务管理
  </a>
<nav aria-label="2. Spring事务管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#21-programmatically">
    2.1. 编程式事务管理（Programmatically）
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#22-declarative">
    2.2 声明式事务管理（Declarative）
  </a>
<nav aria-label="2.2 声明式事务管理（Declarative）" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#221-xml">
    2.2.1. 在 XML 中声明
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#222-transactional">
    2.2.2. 使用 @Transactional 注解声明
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#223">
    2.2.3. 声明式事务实现
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#23-transactionmanager">
    2.3. TransactionManager接口
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#24">
    2.4. 物理事务与逻辑事务（事务的传播）
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#25-transactionsynchronizationmanager">
    2.5. TransactionSynchronizationManager 类
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#26">
    2.6. 事务回滚
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#27">
    2.7. 事务隔离级别
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#28">
    2.8. 事务易错点
  </a>
<nav aria-label="2.8. 事务易错点" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
    调用同一个类中的方法
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3">
    3. 总结
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4">
    4. 思考题
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="spring">Spring事务管理<a class="headerlink" href="#spring" title="Permanent link">¶</a></h1>
<blockquote>
<p>https://www.marcobehler.com/guides/spring-transaction-management-transactional-in-depth#transactional-spring-boot</p>
</blockquote>
<h2 id="1-jdbc">1. JDBC事务管理<a class="headerlink" href="#1-jdbc" title="Permanent link">¶</a></h2>
<p><img alt="The-JDBC-architecture.jpg" src="../99_misc/The-JDBC-architecture.jpg"/></p>
<p>Spring的事务管理都基于此。</p>
<h3 id="11">1.1. 基本创建、提交、回滚事务<a class="headerlink" href="#11" title="Permanent link">¶</a></h3>
<pre><code class="language-Java">import java.sql.Connection;

Connection connection = dataSource.getConnection(); // 1

try (connection) {
    connection.setAutoCommit(fasle); // 2
    // 执行SQL语句
    connection.commit(); // 3
} catch (SQLException e) {
    connection.rollback(); // 4
}
</code></pre>
<p>1、获取跟数据库的连接。</p>
<p>2、setAutoCommit() 开启事务（唯一方式）。入参为 true 时，每条SQL语句都会有自己的事务，false 反之。</p>
<p>3、提交事务。</p>
<p>4、 出现异常，回滚事务。</p>
<p><img alt="SQLException.png" src="../../../../99_Attachment/SQLException.png"/></p>
<blockquote>
<p>HikariCP 等连接池可能会自动切换到自动提交模式</p>
</blockquote>
<h3 id="12">1.2. 隔离级别和保存点<a class="headerlink" href="#12" title="Permanent link">¶</a></h3>
<pre><code class="language-Java">import java.sql.Connection;

// isolation = TransactionDefinition.ISOLATION_READ_UNCOMMITED
connection.setTransactionIsolation(Connection.TRANSACTION_READ_UNCOMMITTED); // 1

// propagation=TransactionDefinition.NESTED
Savepoint savePoint = connection.setSavePint(); // 2
...
connection.rollback(savePoint);
</code></pre>
<p>1、在数据库连接上设置隔离级别。</p>
<p>2、嵌套事务直接使用的是数据库的保存点。</p>
<h2 id="2-spring">2. Spring事务管理<a class="headerlink" href="#2-spring" title="Permanent link">¶</a></h2>
<p>Spring Core 负责管理事务。Spring MVC 和 Spring boot 中的事务管理方式一模一样。</p>
<p>Spring事务管理的核心就是<em>如何创建、提交、回滚 JDBC 事务</em>。</p>
<h3 id="21-programmatically">2.1. 编程式事务管理（Programmatically）<a class="headerlink" href="#21-programmatically" title="Permanent link">¶</a></h3>
<p>通过 TransactionTemplate 实例，或直接通过 PlatformTansactionManager。</p>
<pre><code class="language-Java">@Service
public class UserService {

    @Autowired
    private TransactionTemplate template;

    public Long registerUser(User user) {
        Long id = template.execute(status -&gt; {
            // 插入User SQL，返回自动生成的id;
            return id;
        });
    }
}
</code></pre>
<p>相较于直接操作JDBC事务，这种方式有以下特点：</p>
<ul>
<li>无需手动处理数据库连接，使用 TransactionCallback 封装业务逻辑；</li>
<li>无需捕获 SQLExceptions 异常，会自动转换成运行时异常；</li>
<li>TransactionTemplate 内部使用 TransactionManager接口（封装事务提交、回滚，查看状态的方法），里面再使用一个数据源，这些都是声明在 Spring context 中的 bean。</li>
<li>推荐在命令式编程中使用。</li>
</ul>
<h3 id="22-declarative">2.2 声明式事务管理（Declarative）<a class="headerlink" href="#22-declarative" title="Permanent link">¶</a></h3>
<h4 id="221-xml">2.2.1. 在 XML 中声明<a class="headerlink" href="#221-xml" title="Permanent link">¶</a></h4>
<pre><code class="language-XML">&lt;!-- the transactional advice (what 'happens'; see the &lt;aop:advisor/&gt; bean below) --&gt;
    &lt;tx:advice id="txAdvice" transaction-manager="txManager"&gt;
        &lt;!-- the transactional semantics... --&gt;
        &lt;tx:attributes&gt;
            &lt;!-- all methods starting with 'get' are read-only --&gt;
            &lt;tx:method name="get*" read-only="true"/&gt;
            &lt;!-- other methods use the default transaction settings (see below) --&gt;
            &lt;tx:method name="*"/&gt;
        &lt;/tx:attributes&gt;
    &lt;/tx:advice&gt;
</code></pre>
<p>上述代码块指定了一个事务的 AOP advice，之前的 UserService bean 可以这样声明：</p>
<pre><code class="language-XML">&lt;aop:config&gt;
    &lt;aop:pointcut id="userServiceOperation" expression="execution(* x.y.service.UserService.*(..))"/&gt;
    &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="userServiceOperation"/&gt;
&lt;/aop:config&gt;

&lt;bean id="userService" class="x.y.service.UserService"/&gt;
</code></pre>
<pre><code class="language-Java">public class UserService {

    public Long registerUser(User user) {
        // 插入User SQL，返回自动生成的id;
        return id;
    }
}
</code></pre>
<h4 id="222-transactional">2.2.2. 使用 @Transactional 注解声明<a class="headerlink" href="#222-transactional" title="Permanent link">¶</a></h4>
<p>无需冗长的XML：</p>
<pre><code class="language-Java">public class UserService {

    @Transactional
    public Long registerUser(User user) {
        // 插入User SQL，返回自动生成的id;
        return id;
    }
}
</code></pre>
<p>使用注解声明式事务，需要以下操作：</p>
<ul>
<li>配置包含 @EnableTransactionManagement 注解。（Spring boot 自动完成）</li>
<li>在配置中指定 transaction manager。</li>
</ul>
<pre><code class="language-Java">@Configration
@EnableTransactionManagement
public class MySpingConfig {

    @Bean
    public PlatformTransactionManager txManager() {
        return yourTxManager
    }
}
</code></pre>
<p>这样，带有 @Transactional 注解的 public 方法都会在事务中执行。</p>
<p><img alt="Pasted image 20220510205849.png" src="../../../../99_Attachment/Pasted%20image%2020220510205849.png"/></p>
<h4 id="223">2.2.3. 声明式事务实现<a class="headerlink" href="#223" title="Permanent link">¶</a></h4>
<p>基于 Spring 的 AOP 机制：当使用的 bean 中包含 @Transactional 注解（无论类或方法）时，Spring IOC 容器会借助于 Cglib 返回一个原始类的事务代理实例，TransactionInterceptor。</p>
<p><img alt="01_spring_transactional_proxy.png" src="../99_misc/01_spring_transactional_proxy.png"/></p>
<p>如图，代理类通过 TransactionManager接口 执行开关数据库连接与事务的提交，委派给原始类实例处理真正的业务逻辑。</p>
<h3 id="23-transactionmanager">2.3. TransactionManager接口<a class="headerlink" href="#23-transactionmanager" title="Permanent link">¶</a></h3>
<p>Spring 提供了  TransactionManager/PlatformTransactionManager 接口，有一些默认的实现，比如JDBC连接的 DataSourceTransactionManager。</p>
<pre><code class="language-Java">@Bean
public DataSource dataSource() {
    return new MysqlDataSource();
}

@Bean
public PlatformTransactionManager txManager() {
    return new DataSourceTransactionManager(dataSource());
}
</code></pre>
<p>如代码所示，TransactionManager 需要一个可以控制事务的 data source。</p>
<pre><code class="language-Java">public class DataSourceTransactionManager implements PlatformTransactionManager {

    @Override
    protected void doBegin(Object transaction, TransactionDefinition definition) {
        Connection newCon = obtainDataSource().getConnection();
        // ...
        con.setAutoCommit(false);
    }

    @Override
    protected void doCommit(DefaultTransactionStatus status) {
        // ...
        Connection con = status.getTransaction().getConnectionHolder().getConnection();
        try {
            con.commit();
        } catch (SQLException ex) {
            throw new TransactionSystemException("Could not commit JDBC transaction", ex);
        }
    }

    @Override
    protected void doRollback(DefaultTransactionStatus status) {
        // ...
        Connection con = status.getTransaction().getConnectionHolder().getConnection();
        try {
            con.rollback();
        }
        catch (SQLException ex) {
            throw translateException("JDBC rollback", ex);
        }
    }

    @Override
    protected Object doGetTransaction() {
        DataSourceTransactionObject txObject = new DataSourceTransactionObject();
        txObject.setSavepointAllowed(isNestedTransactionAllowed());
        ConnectionHolder conHolder =
                (ConnectionHolder) TransactionSynchronizationManager.getResource(obtainDataSource());
        txObject.setConnectionHolder(conHolder, false);
        return txObject;
    }


}
</code></pre>
<p>所有的 TransactionManager 都包含 doBegin() 方法来开启事务，doCommit() 方法来提交事务，doRollback() 方法来回滚事务，doGetTransaction() 方法来获取<em>事务状态</em>。</p>
<h3 id="24">2.4. 物理事务与逻辑事务（事务的传播）<a class="headerlink" href="#24" title="Permanent link">¶</a></h3>
<p>假设有两个事务性的类。</p>
<pre><code class="language-Java">@Service
public class UserService {

    @Autowired
    private InvoiceService invoiceService;

    @Transactional
    public void invoice() {
        invoiceService.createPdf();
        // send invoice as email, etc.
    }
}

@Service
public class InvoiceService {

    @Transactional
    public void createPdf() {
        // ...
    }
}
</code></pre>
<p>这个例子中，数据库中只会有一个事务，Spring称之为<em>物理事务</em>（JDBC 事务）。而 UserService 和 InvoiceService 中有2个<em>逻辑事务</em>。</p>
<pre><code class="language-Java">public class InvoiceService {

    @Transactional(propagation = Propagation.REQUIRES_NEW)
    public void createPdf() {
        // ...
    }
}
</code></pre>
<p>改变 createPdf() 方法的事务传播模式，比如 REQUIRES_NEW，他就需要自己的物理事务了。于是原来的代码会产生2个 connection，2个trancations（2个完整的 JDBC 事务）。</p>
<p>不同的事务传播模式对应的 JDBC 操作：
+ Required：需要事务，没有则创建 -&gt; getConnection(). setAutocommit(false). commit().
+ Supports：加入外层事务，没有也不创建 -&gt; nothing
+ Mandatory：加入外层事务，没有则报错 -&gt; nothing
+ Requires_new：需要新的事务 -&gt; getConnection(). setAutocommit(false). commit().
+ Not_Supported：不需要事务，等待外层事务结束 -&gt; nothing
+ Never：不需要事务，外层有事务则报错 -&gt; nothing
+ Nested：外层事务的嵌套事务，如果没有则创建 -&gt; connection.setSavepoint()</p>
<h3 id="25-transactionsynchronizationmanager">2.5. TransactionSynchronizationManager 类<a class="headerlink" href="#25-transactionsynchronizationmanager" title="Permanent link">¶</a></h3>
<p>使用ThreadLocal来为不同的事务线程提供独立的资源副本，并且同时维护这些事物的配置属性和运行状态。</p>
<pre><code class="language-Java">public abstract class TransactionSynchronizationManager {
    // 线程上下文中保存着[线程池对象：ConnectHolder]的Map对象。线程可以通过该属性获取到同一个Connection对象
    private static final ThreadLocal&lt;Map&lt;Object, Object&gt;&gt; resources = new NamedThreadLocal&lt;&gt;("Transactional resources");

    // 事务同步器，自定义扩展方法，每个线程都可以注册N个事务同步器
    private static final ThreadLocal&lt;Set&lt;TransactionSynchronization&gt;&gt; synchronizations = new NamedThreadLocal&lt;&gt;("Transaction synchronizations");

    private static final ThreadLocal&lt;String&gt; currentTransactionName =
            new NamedThreadLocal&lt;&gt;("Current transaction name");

    private static final ThreadLocal&lt;Boolean&gt; currentTransactionReadOnly =
            new NamedThreadLocal&lt;&gt;("Current transaction read-only status");

    private static final ThreadLocal&lt;Integer&gt; currentTransactionIsolationLevel =
            new NamedThreadLocal&lt;&gt;("Current transaction isolation level");

    private static final ThreadLocal&lt;Boolean&gt; actualTransactionActive =
            new NamedThreadLocal&lt;&gt;("Actual transaction active");


    // 获取连接
    @Nullable
    public static Object getResource(Object key) {
        ...
        return doGetResource(actualKey);
    }

    // 将线程（工厂类）与真实连接进行绑定
    public static void bindResource(Object key, Object value) throws IllegalStateException {
        ...
        Map&lt;Object, Object&gt; map = resources.get();
        // set ThreadLocal Map if none found
        if (map == null) {
            map = new HashMap&lt;&gt;();
            resources.set(map);
        }
        Object oldValue = map.put(actualKey, value);
        ...
    }
    ...
}
</code></pre>
<p>TransactionManager 在 doBegin() 方法打开事务时会将连接放到 TransactionSynchronizationManager 中与线程绑定，在 doGetTransaction() 方法中取得线程对应的连接。</p>
<p>事物同步的扩展点 TransactionSynchronization。用于事物同步回调的接口，TransactionManager 在 doCommit() 方法完成后会回调 afterCommit()。可用 registerSynchronization 注册到同步管理器中。</p>
<pre><code class="language-Java">public abstract class TransactionSynchronizationAdapter implements TransactionSynchronization, Ordered {

    // 事务挂起
    public void suspend() {
    }

    //事务恢复
    public void resume() {
    }

    // 将基础会话刷新到数据存储区（如果适用）
    public void flush() {
    }

    // 在事务提交前触发，此处若发生异常，会导致回滚
    public void beforeCommit(boolean readOnly) {
    }

    // 在beforeCommit之后，commit/rollback之前执行。即使异常，也不会回滚
    public void beforeCompletion() {
    }

    // 事务提交后执行，对数据库的操作并入之前的事务
    public void afterCommit() {
    }

    // 事务提交/回滚执行
    public void afterCompletion(int status) {
    }

}
</code></pre>
<h3 id="26">2.6. 事务回滚<a class="headerlink" href="#26" title="Permanent link">¶</a></h3>
<p>TransactionTemplate 代码：</p>
<pre><code class="language-Java">public &lt;T&gt; T execute(TransactionCallback&lt;T&gt; action) throws TransactionException {  
    Assert.state(this.transactionManager != null, "No PlatformTransactionManager set");  

    if (this.transactionManager instanceof CallbackPreferringPlatformTransactionManager) {  
        return ((CallbackPreferringPlatformTransactionManager) this.transactionManager).execute(this, action);  
    }  
    else {  
        // 1.通过事物管理器开启事物  
        TransactionStatus status = this.transactionManager.getTransaction(this);  
        T result;  
        try {  
            //2.执行传入的业务逻辑  
            result = action.doInTransaction(status);  
        }  
        catch (RuntimeException | Error ex) {  
            // Transactional code threw application exception -&gt; rollback  
            // 出现异常，进行回滚  
            rollbackOnException(status, ex);  
            throw ex;  
        }  
        catch (Throwable ex) {  
            // Transactional code threw unexpected exception -&gt; rollback  
            //// 出现异常，进行回滚  
            rollbackOnException(status, ex);  
            throw new UndeclaredThrowableException(ex, "TransactionCallback threw undeclared checked exception");  
        }  
        // 执行成功，提交事物  
        this.transactionManager.commit(status);  
        return result;  
    }  
}
</code></pre>
<p>TransactionInterceptor 代码：</p>
<pre><code class="language-Java">
protected void completeTransactionAfterThrowing(@Nullable TransactionInfo txInfo, Throwable ex) {
    //省略非关键代码
    //判断是否需要回滚
    if (txInfo.transactionAttribute != null &amp;&amp; txInfo.transactionAttribute.rollbackOn(ex)) {
       try {
       //执行回滚
txInfo.getTransactionManager().rollback(txInfo.getTransactionStatus());
       }
       catch (TransactionSystemException ex2) {
          ex2.initApplicationException(ex);
          throw ex2;
       }
       catch (RuntimeException | Error ex2) {
          throw ex2;
       }
    }
    //省略非关键代码
}


public boolean rollbackOn(Throwable ex) {
   // 层级 1：根据"rollbackRules"及当前捕获异常来判断是否需要回滚
   RollbackRuleAttribute winner = null;
   int deepest = Integer.MAX_VALUE;
   if (this.rollbackRules != null) {
      for (RollbackRuleAttribute rule : this.rollbackRules) {
         // 当前捕获的异常可能是回滚“异常”的继承体系中的“一员”
         int depth = rule.getDepth(ex);
         if (depth &gt;= 0 &amp;&amp; depth &lt; deepest) {
            deepest = depth;
            winner = rule;
         }
      }
   }
   // 层级 2：调用父类的 rollbackOn 方法来决策是否需要 rollback
   if (winner == null) {
      return super.rollbackOn(ex);
   }
   return !(winner instanceof NoRollbackRuleAttribute);
}


public boolean rollbackOn(Throwable ex) {
   return (ex instanceof RuntimeException || ex instanceof Error);
}
</code></pre>
<p>可知，编程式的事务可以在任何异常类型中回滚，而声明式的事务默认情况下只有 RuntimeException 和 Error 回滚。</p>
<h3 id="27">2.7. 事务隔离级别<a class="headerlink" href="#27" title="Permanent link">¶</a></h3>
<pre><code class="language-Java">@Transactional(isolation = Isolation.REPEATABLE_READ)
</code></pre>
<p>JDBC实现：</p>
<pre><code class="language-Java">connection.setTransactionIsolation(Connection.TRANSACTION_REPEATABLE_READ);
</code></pre>
<blockquote>
<p>事务期间切换隔离级别？须看JDBC和数据库是否支持</p>
</blockquote>
<h3 id="28">2.8. 事务易错点<a class="headerlink" href="#28" title="Permanent link">¶</a></h3>
<h4 id="_1">调用同一个类中的方法<a class="headerlink" href="#_1" title="Permanent link">¶</a></h4>
<pre><code class="language-Java">@Service
public class UserService {

    // //self-injection
    // @AutoWire
    // UserService userService

    @Transactional
    public void invoice() {
        createPdf();
        // send invoice as email, etc.
    }

    @Transactional(propagation = Propagation.REQUIRES_NEW)
    public void createPdf() {
        // ...
    }
}
</code></pre>
<p>两个方法在同一个类中时，只有一个事务代理实例，事务只开一次。</p>
<blockquote>
<p>可通过 self-injection 绕开限制</p>
</blockquote>
<h2 id="3">3. 总结<a class="headerlink" href="#3" title="Permanent link">¶</a></h2>
<p><img alt="overview.png" src="../../../../99_Attachment/overview.png"/></p>
<h2 id="4">4. 思考题<a class="headerlink" href="#4" title="Permanent link">¶</a></h2>
<p>1、Hibernate/JPA 等 ORM 也有自己的事务实现，此时如何实现 Spring 事务管理的兼容？</p>
<pre><code class="language-Java">public class UserService {

    @Autowired
    private SessionFactory sessionFactory; 

    public void registerUser(User user) {

        Session session = sessionFactory.openSession(); 
        session.beginTransaction();
        session.save(user);
        session.getTransaction().commit();
        session.close();
    }
}
</code></pre>
<p>2、试想可以实现在一个事务中操作多个或多种类型的数据库吗？</p>
<p>3、设计一个事务成功提交后才会发送 Kafka 消息的 publisher。</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: 01 索引模块" class="md-footer__link md-footer__link--prev" href="../../00_Kafka/01_broker/01_%E7%B4%A2%E5%BC%95%E6%A8%A1%E5%9D%97/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              01 索引模块
            </div>
</div>
</a>
<a aria-label="Next: 题目名称" class="md-footer__link md-footer__link--next" href="../../../../99_Attachment/00_%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95%E6%A8%A1%E6%9D%BF/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              题目名称
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../../../..", "features": [], "search": "../../../../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
<script src="../../../../../assets/javascripts/bundle.6c7ad80a.min.js"></script>
<script src="../../../../../javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</body>
</html>